# إعداد Storage في Supabase لحل مشكلة رفع الصور

## المشكلة:
عند محاولة رفع صورة عند التسجيل كصايغ، يظهر خطأ "حدث خطأ في رفع الصورة"

## الحل:

### الخطوة 1: إنشاء Storage Bucket

1. افتح **Supabase Dashboard**
2. اذهب إلى **Storage** (من القائمة الجانبية)
3. اضغط على **"New bucket"** أو **"إنشاء bucket جديد"**
4. املأ البيانات:
   - **اسم الـ Bucket**: `public` (يجب أن يكون بالضبط هكذا)
   - **Public bucket**: ✅ **فعّل هذا الخيار** (مهم جداً!)
   - **File size limit**: 5 MB (أو 10 MB)
   - **Allowed MIME types**: اتركه فارغ

5. اضغط **"Create bucket"** أو **"إنشاء"**

### الخطوة 2: إضافة Storage Policies (الصلاحيات)

1. اذهب إلى **Supabase Dashboard** > **SQL Editor**
2. افتح الملف: `supabase/migrations/20260112000002_storage_policies.sql`
3. انسخ كل محتوى الملف
4. الصقه في SQL Editor
5. اضغط **Run** أو **تشغيل**

### الخطوة 3: التحقق من الإعداد

1. اذهب إلى **Storage** > **Policies**
2. تأكد من وجود السياسات التالية:
   - ✅ Authenticated users can upload goldsmith files
   - ✅ Users can update their own goldsmith files
   - ✅ Users can delete their own goldsmith files
   - ✅ Public can read files in public bucket
   - ✅ Users can read their own goldsmith files

### الخطوة 4: اختبار

1. اذهب إلى صفحة التسجيل كصايغ: `/goldsmith/register`
2. حاول رفع صورة
3. إذا ظهرت رسالة "تم رفع الصورة بنجاح" ✅ فالإعداد صحيح

## حلول للمشاكل الشائعة:

### المشكلة 1: "bucket does not exist"
**الحل**: تأكد من إنشاء الـ bucket اسمه `public` في الخطوة 1

### المشكلة 2: "new row violates row-level security"
**الحل**: تأكد من تطبيق الـ Storage policies في الخطوة 2

### المشكلة 3: "insufficient permissions"
**الحل**: 
1. تأكد من تفعيل **Public bucket** في إعدادات الـ bucket
2. تأكد من تطبيق جميع الـ policies

### المشكلة 4: "file too large"
**الحل**: 
1. تأكد من أن حجم الصورة أقل من الحد المسموح (5 MB)
2. يمكنك زيادة الحد في إعدادات الـ bucket

## ملاحظات مهمة:

- ✅ تأكد من أن اسم الـ bucket هو بالضبط `public` (أحرف صغيرة)
- ✅ تأكد من تفعيل **Public bucket**
- ✅ تأكد من تطبيق جميع الـ policies
- ✅ افتح Console في المتصفح (F12) لرؤية تفاصيل الخطأ

## إذا استمرت المشكلة:

1. افتح **Developer Tools** في المتصفح (F12)
2. اذهب إلى **Console**
3. حاول رفع صورة مرة أخرى
4. انسخ رسالة الخطأ الكاملة
5. شاركها مع الفريق التقني
